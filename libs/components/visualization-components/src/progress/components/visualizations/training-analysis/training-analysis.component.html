<!-- main filters -->
<div class="ctf-progress-wrapper">
    <div class="container-fluid">
        <div class="row ctf-progress-head-wrapper col-12">
            <div class="ctf-progress-options">
                @if (!errorMessage) {
                    <div class="ctf-progress-select-wrapper">
                        <div class="ctf-progress-select">
                            <svg class="ctf-progress-select-icon" height="20" viewBox="0 0 24 24" width="20">
                                <path [attr.d]="$any(getEventShapePaths()).filter"/>
                            </svg>
                            <select (change)="onFilterValueChange()" [(ngModel)]="selectedFilterValue">
                                @for (o of filterOptions; track o) {
                                    <option [ngValue]="o.id">{{ o.name }}</option>
                                }
                            </select>
                        </div>
                    </div>
                }

                @if (!errorMessage && !setDashboardView) {
                    <div class="ctf-progress-select-wrapper">
                        <div class="ctf-progress-select">
                            <svg class="ctf-progress-select-icon" height="20" viewBox="0 0 24 24" width="20">
                                <path [attr.d]="$any(getEventShapePaths()).person"/>
                            </svg>
                            <select (change)="onTraineeViewChange()" [(ngModel)]="selectedTraineeView">
                                <option [ngValue]="'name'">Name</option>
                                <option [ngValue]="'avatar'">Avatar</option>
                                <option [ngValue]="'both'">Avatar + Name</option>
                            </select>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- detailed individual view? -->
    @if (traineeDetailId) {
        <div class="trainee-detail-container">
            <crczp-trainee-detail
                (hideDetail)="onTraineeDetailChange()"
                [trainee]=getTraineeData(traineeDetailId)
                [trainingInstanceId]="trainingInstanceId"
                [visualizationData]="visualizationData"/>
        </div>
    }

    <!-- main view with visualization -->
    @if (!traineeDetailId) {
        <div (window:resize)="onResize()" class="visualization-container overview">
            <div class="ctfh-row align-items-end ctfh-no-gutters">
                @if (hasData) {
                    <div class="ctfh-col-2 final-2-name">
                        <div class="ctf-progress-column ctf-progress-teamcolumn">
                            <crczp-viz-hurdling-column-header
                                (sortEmitter)="onSortValueChange('name', $event.sortReverse)"
                                [label]="'Trainee'"
                                [selectedSortReverse]="sortReverse"
                                [selectedSortType]="sortType"
                                [sortType]="'name'"/>
                        </div>
                    </div>
                }
                @if (hasData) {
                    <div class="ctfh-col-2 short"></div>
                }
                @if (hasData) {
                    <div class="ctfh-col-8 final-8">
                        <div class="ctf-progress-header-levels">
                            @for (level of levelSortOptions; track level) {
                                <crczp-viz-hurdling-column-header
                                    (sortEmitter)="onSortValueChange('level', $event.sortReverse, level.index)"
                                    [label]="level.name"
                                    [level]="level"
                                    [selectedSortReverse]="sortReverse"
                                    [selectedSortType]="sortType + sortLevel"
                                    [sortType]="'level' + level.index"/>
                            }
                        </div>
                    </div>
                }
                @for (column of columns; track column) {
                    <div [ngClass]="{ 'final-2': view === 'overview' && column === 'time' }" class="ctfh-col-2">
                        <div class="{{'ctf-progress-column ctf-progress-' + column + 'column'}}">
                            <crczp-viz-hurdling-column-header
                                (sortEmitter)="onSortValueChange(column, $event.sortReverse)"
                                [label]="column.charAt(0).toUpperCase() + column.slice(1)"
                                [selectedSortReverse]="sortReverse"
                                [selectedSortType]="sortType"
                                [sortType]="column"/>
                        </div>
                    </div>
                }
            </div>
            @if (!hasData) {
                <div class="empty-data">No {{ filterStatus }} trainings available.</div>
            }
            <div class="ctfh-row ctfh-no-gutters ctf-main-container">
                <div class="ctfh-col-2 final-2-name">
                    <div (click)="showTraineeDetail($event)" class="ctf-progress-column ctf-progress-teamcolumn
                ctf-progress-column-data" id="ctf-progress-teamcolumn"></div>
                </div>
                <div class="ctfh-col-2 short">
                    <div class="ctf-progress-column ctf-progress-comparecolumn ctf-progress-column-data"
                         id="ctf-progress-comparecolumn">
                    </div>
                </div>
                <div class="ctfh-col-8 final-8" id="hurdling-space">
                    <div class="ctf-progress-chart-wrapper">
                        <div (mouseDrag)="onMouseDrag($event)"
                             (mouseUp)="onMouseUp()"
                             (mouseWheelDown)="onMouseWheelDown($event)"
                             (mouseWheelUp)="onMouseWheelUp($event)"
                             (window:resize)="onResize()"
                             [ngStyle]="{'cursor': 'pointer'}"
                             class="ctf-progress"
                             id="ctf-progress-chart"
                             mouseMove
                             mouseWheel></div>
                    </div>
                </div>
                @for (column of columns; track column) {
                    <div [ngClass]="{ 'final-2': view === 'overview' && column === 'time' }" class="ctfh-col-2">
                        <div
                            class="{{'ctf-progress-column ctf-progress-' + column + 'column ctf-progress-column-data'}}"
                            id="{{'ctf-progress-' + column + 'column'}}">
                        </div>
                    </div>
                }
            </div>
            <div class="legend-container">
                <crczp-viz-hurdling-legend
                    (zoomResetChange)="onZoomReset()"
                    [selectedViewValue]="view"/>
            </div>
        </div>
    }

    @if (errorMessage) {
        <div class="ctfh-container-fluid">
            <div class="ctfh-row ctfh-no-gutters ctfh-col-sm-8 ctfh-offset-sm-2">
                <p class="ctf-progress-error">
                    <svg class="ctf-progress-error-icon" height="20" viewBox="0 0 24 24" width="20">
                        <path d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"/>
                    </svg>
                    {{ errorMessage }}
                </p>
            </div>
        </div>
    }


</div>
