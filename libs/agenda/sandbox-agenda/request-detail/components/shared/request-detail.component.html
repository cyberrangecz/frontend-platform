@if (stages$ | async; as stages) {
    @if (hasError$ | async) {
        <mat-card appearance="outlined" class="error">
            <span>We had some trouble loading the data.</span>
            <button mat-icon-button (click)="reloadStages()" color="primary">
                <mat-icon>refresh</mat-icon>
            </button>
        </mat-card>
    }
    @if (stages?.length > 0) {
        @for (stage of stages.values(); track trackByFn(i, stage); let i = $index) {
            @if ((fragment && 'stage-' + i === fragment) || !fragment) {
                <crczp-request-stage
                    id="{{ 'stage-' + i }}"
                    [stage]="stage"
                    (stageDetailPanelChange)="onStageDetailPanelChange($event, stage)"
                >
                </crczp-request-stage>
            }
        }
    } @else {
        @if ((isLoading$ | async) === false) {
            <h2>Request has no stages</h2>
        }
    }
}
