<mat-expansion-panel [expanded]="true">
    <mat-expansion-panel-header>
        <mat-panel-title>
            @if (editMode$ | async) {
                Edit Training Instance
            } @else {
                Create Training Instance
            }
            <mat-panel-description>
                <span class="spacer"></span>
                @if (!canRefreshOrLeave()) {
                    <div class="panel-description-error">
                        <mat-icon color="warn">warning</mat-icon>
                        <mat-error>Changes are not saved</mat-error>
                    </div>
                }
                <mat-icon>edit</mat-icon>
            </mat-panel-description>
        </mat-panel-title>
    </mat-expansion-panel-header>
    <ng-template matExpansionPanelContent>
        <sentinel-controls (itemClicked)="onControlsAction($event)" [controls]="controls">
        </sentinel-controls>
        <mat-divider />
        <crczp-training-instance-edit
            (edited)="onTrainingInstanceChanged($event)"
            [editMode]="editMode$ | async"
            [hasStarted]="hasStarted$ | async"
            [localEnvironmentAllowed]="isLocalEnvironmentAllowed()"
            [pools]="pools$ | async"
            [sandboxDefinitions]="sandboxDefinitions$ | async"
            [trainingDefinitions]="trainingDefinitions$ | async"
            [trainingInstance]="trainingInstance$ | async">
        </crczp-training-instance-edit>
        <ng-content></ng-content>
    </ng-template>
</mat-expansion-panel>

<!-- EDIT ORGANIZERS -->

@if (editMode$ | async) {
    <mat-expansion-panel [expanded]="editMode$ | async">
        <mat-expansion-panel-header>
            <mat-panel-title>Organizers</mat-panel-title>
            <mat-panel-description>
                <span class="spacer"></span>
                @if (!canDeactivateOrganizers) {
                    <div class="panel-description-error">
                        <mat-icon color="warn">warning</mat-icon>
                        <mat-error>Organizers are not saved</mat-error>
                    </div>
                }
                <mat-icon>person</mat-icon>
            </mat-panel-description>
        </mat-expansion-panel-header>
        <ng-template matExpansionPanelContent>
            <sentinel-user-assign
                (hasUnsavedChanges)="onOrganizersChanged($event)"
                [defaultPaginationSize]="PAGE_SIZE"
                [resource]="trainingInstance$ | async"
                assigneesTitle="Organizers"
                resourceMatIcon="event_available"
                toAssignTitle="Organizers">
            </sentinel-user-assign>
        </ng-template>
    </mat-expansion-panel>
}
