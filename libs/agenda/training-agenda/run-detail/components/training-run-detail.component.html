<div class="header">
  <!-- LEVEL STEPPER -->
  @if (isStepperDisplayed && stepper?.items) {
    <div class="training-run-stepper round-scrollbar">
      <sentinel-stepper
        [draggable]="false"
        [selectable]="backwardMode"
        (indexSelected)="activeStepChanged($event)"
        [stepperItems]="stepper"
        [activeIndex]="stepper.activeLevelIndex"
        >
      </sentinel-stepper>
    </div>
  }
</div>

@if (activeLevel$ | async; as activeLevel) {
  <!-- CONTENT OF ACTIVE LEVEL -->
  <crczp-abstract-level
    [hidden]="(backtrackedLevel$ | async) && activeLevel.id !== stepper.items[stepper.activeLevelIndex].id"
    [level]="activeLevel"
    [isLast]="isLast"
    [isLevelAnswered]="isCurrentLevelAnswered$ | async"
    [isStepperDisplayed]="isStepperDisplayed"
    [sandboxInstanceId]="sandboxInstanceId"
    [sandboxDefinitionId]="sandboxDefinitionId"
    [localEnvironment]="localEnvironment"
    [isBacktracked]="false"
    [startTime]="startTime"
    (next)="next()"
    />
  @if ((backtrackedLevel$ | async) && activeLevel.id !== stepper.items[stepper.activeLevelIndex].id) {
    <crczp-abstract-level
      [level]="backtrackedLevel$ | async"
      [isLast]="isLast"
      [isStepperDisplayed]="isStepperDisplayed"
      [sandboxInstanceId]="sandboxInstanceId"
      [sandboxDefinitionId]="sandboxDefinitionId"
      [localEnvironment]="localEnvironment"
      [isBacktracked]="true"
      [startTime]="startTime"
      (next)="this.activeStepChanged(this.stepper.activeLevelIndex + 1)"
      />
  }
}

