<form [formGroup]="freeFormQuestionFormGroup.freeFormQuestionFormGroup">
    <div class="content">
        <!-- TITLE field-->
        <h3>Title</h3>
        <div class='question-text'>
            <sentinel-markdown-editor
                (contentChange)="title.setValue($event)"
                [content]="title.value"
                [sentinel-markdown-file-upload]="false"
                class="mrkdwn-content"
            />
            @if (title.hasError('whitespace')) {
                <mat-error>Title cannot be empty</mat-error>
            }
        </div>

        @if (isTest) {
            <div class="inline-input">
                <!-- SCORE field -->
                <mat-form-field appearance="outline" hintLabel="Number in range from 0 to
        {{ maxQuestionScore }}">
                    <mat-label>Points</mat-label>
                    <input matInput placeholder="Points" type="number"
                           [max]="maxQuestionScore" min="0" formControlName="score"
                           [required]="required">
                    @if (score.hasError('required')) {
                        <mat-error>Question score cannot be
                            empty
                        </mat-error>
                    }
                    @if (score.hasError('pattern') || score.hasError('min') ||
                    score.hasError('max')) {
                        <mat-error>Question score must be a number in range from 0
                            to {{ this.maxQuestionScore }}
                        </mat-error>
                    }
                </mat-form-field>
                <!-- PENALTY field -->
                <mat-form-field appearance="outline" hintLabel="Number in range from 0 to
        {{ maxQuestionPenalty }}">
                    <mat-label>Penalty points</mat-label>
                    <input matInput placeholder="Question Penalty points" type="number"
                           [max]="maxQuestionPenalty" min="0" formControlName="penalty"
                           [required]="required">
                    @if (penalty.hasError('required')) {
                        <mat-error>Question penalty cannot
                            be empty
                        </mat-error>
                    }
                    @if (penalty.hasError('pattern') || penalty.hasError('min')
                    || penalty.hasError('max')) {
                        <mat-error>Question penalty must be a number in range
                            from 0 to this.{{ maxQuestionPenalty }}
                        </mat-error>
                    }
                </mat-form-field>
            </div>
        }

        <!-- CORRECT CHOICES field -->
        @if (isTest) {
            <div class="form-container">
                <!-- ADD button-->
                <button color="primary" mat-button (click)="addChoice()">Add answer</button>
                <!-- DELETE button-->
                <button [disabled]="choices.controls.length < 1" color="warn" mat-button (click)="clearChoices()">Delete
                    all
                </button>
                <!-- Choice field-->
                <div formArrayName="choices" class="choices">
                    @if (choices.controls && choices.controls.length > 0) {
                        <div>
                            @for (choice of choices.controls; track trackByFn(i); let i = $index) {
                                <div class="answer"
                                     [formGroupName]="i">
                                    <mat-form-field appearance="outline" (keydown.enter)="$event.preventDefault()">
                                        <mat-label>Answer</mat-label>
                                        <input matInput placeholder="Answer" [formControl]="$any(choice.get('text'))"/>
                                        @if (choice.get('text').value) {
                                            <button
                                                class="free-form-clear-btn"
                                                matSuffix
                                                mat-icon-button
                                                aria-label="Clear"
                                                (click)="choice.get('text').setValue('')">
                                                <mat-icon>close</mat-icon>
                                            </button>
                                        }
                                        @if (choice.get('text').hasError('whitespace')) {
                                            <mat-error>Answer cannot be empty
                                            </mat-error>
                                        }
                                    </mat-form-field>
                                    <!-- REMOVE button-->
                                    <button
                                        class="remove-btn"
                                        mat-button color="warn"
                                        (click)="deleteChoice(i)">
                                        <mat-icon>remove_circle</mat-icon>
                                    </button>
                                </div>
                            }
                        </div>
                    } @else {
                        <h4>No answers added</h4>
                    }
                </div>
            </div>
        }

        @if (isTest &&
        freeFormQuestionFormGroup.freeFormQuestionFormGroup.hasError('noSelectedChoices')) {
            <mat-error>Test
                question must have correct answers.
            </mat-error>
        }
    </div>
</form>
